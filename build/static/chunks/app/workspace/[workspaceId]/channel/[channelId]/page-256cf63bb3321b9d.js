(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[979],{6822:function(e,s,t){Promise.resolve().then(t.bind(t,6463))},6463:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return T}});var l=t(7437),a=t(6540),r=t(6865),n=t(8291),i=t(7266),o=t(1620);let d=e=>{let{id:s}=e,t=(0,i.aM)(o.h.channels.getById,{id:s});return{data:t,isLoading:void 0===t}};var c=t(4749),u=t(4438),m=t(2265),h=t(7413),x=t(9376),f=t(9089),b=t(3106),g=t(5863),p=t(9279);let v=()=>{let[e,s]=(0,m.useState)(null),[t,l]=(0,m.useState)(null),[a,r]=(0,m.useState)(null),n=(0,m.useMemo)(()=>"pending"===a,[a]),d=(0,m.useMemo)(()=>"success"===a,[a]),c=(0,m.useMemo)(()=>"error"===a,[a]),u=(0,m.useMemo)(()=>"settled"===a,[a]),h=(0,i.Db)(o.h.channels.update);return{mutate:(0,m.useCallback)(async(e,t)=>{var a,n,i;try{s(null),l(null),r("pending");let n=await h(e);return null==t||null===(a=t.onSuccess)||void 0===a||a.call(t,n),n}catch(e){if(r("error"),null==t||null===(n=t.onError)||void 0===n||n.call(t,e),null==t?void 0:t.throwError)throw e}finally{r("settled"),null==t||null===(i=t.onSettled)||void 0===i||i.call(t)}},[h]),data:e,error:t,isPending:n,isSuccess:d,isError:c,isSettled:u}},j=()=>{let[e,s]=(0,m.useState)(null),[t,l]=(0,m.useState)(null),[a,r]=(0,m.useState)(null),n=(0,m.useMemo)(()=>"pending"===a,[a]),d=(0,m.useMemo)(()=>"success"===a,[a]),c=(0,m.useMemo)(()=>"error"===a,[a]),u=(0,m.useMemo)(()=>"settled"===a,[a]),h=(0,i.Db)(o.h.channels.remove);return{mutate:(0,m.useCallback)(async(e,t)=>{var a,n,i;try{s(null),l(null),r("pending");let n=await h(e);return null==t||null===(a=t.onSuccess)||void 0===a||a.call(t,n),n}catch(e){if(r("error"),null==t||null===(n=t.onError)||void 0===n||n.call(t,e),null==t?void 0:t.throwError)throw e}finally{r("settled"),null==t||null===(i=t.onSettled)||void 0===i||i.call(t)}},[h]),data:e,error:t,isPending:n,isSuccess:d,isError:c,isSettled:u}};var y=t(279),N=t(2381),w=t(4291),C=e=>{let{title:s}=e,t=(0,x.useRouter)(),a=(0,n.b)(),r=(0,b.m)(),{data:i}=(0,p.i)({workspaceId:r}),[o,d]=(0,m.useState)(s),[c,C]=(0,m.useState)(""),[M,S]=(0,m.useState)(!1),[E,_]=(0,g.t)("Delete this channel?","You are about to permanently delete this channel from your workspace. This action is irreversible."),{mutate:k,isPending:I}=v(),{mutate:T,isPending:z}=j(),L=async()=>{await _()&&T({id:a},{onSuccess:()=>{u.Am.success("Channel deleted successfully"),t.push("/workspace/".concat(r))},onError:()=>{u.Am.error("Failed to delete channel")}})},A=()=>{C("")};return(0,l.jsxs)("div",{className:"bg-white border-b h-[49px] flex items-center px-4 overflow-hidden",children:[(0,l.jsx)(E,{}),(0,l.jsxs)(w.Vq,{children:[(0,l.jsx)(w.hg,{asChild:!0,children:(0,l.jsxs)(N.z,{variant:"ghost",className:"text-lg font-semibold px-2 overflow-hidden w-auto",size:"sm",children:[(0,l.jsxs)("span",{className:"truncate",children:["# ",s]}),(0,l.jsx)(f.RiI,{className:"size-2.5 ml-2"})]})}),(0,l.jsxs)(w.cZ,{className:"p-0 bg-gray-50 overflow-hidden rounded-xl",children:[(0,l.jsx)(w.fK,{className:"p-4 border-b bg-gray-100 transition-colors",children:(0,l.jsxs)(w.$N,{children:["# ",s]})}),(0,l.jsxs)("div",{className:"px-4 pb-4 flex flex-col gap-y-2",children:[(0,l.jsxs)(w.Vq,{open:M,onOpenChange:e=>{(null==i?void 0:i.role)==="admin"&&(e&&C(s),S(e))},children:[(0,l.jsx)(w.hg,{asChild:!0,children:(0,l.jsxs)("div",{className:"px-5 py-4 bg-white rounded-lg border cursor-pointer hover:bg-gray-50",children:[(0,l.jsxs)("div",{className:"flex items-center justify-between",children:[(0,l.jsx)("p",{className:"text-sm font-semibold",children:"Channel name"}),(null==i?void 0:i.role)==="admin"&&(0,l.jsx)("p",{className:"text-sm text-[#1264a3] hover:underline font-semibold",children:"Edit"})]}),(0,l.jsxs)("p",{className:"text-sm",children:["# ",s]})]})}),(0,l.jsxs)(w.cZ,{className:"p-0 bg-gray-50 overflow-hidden rounded-xl",children:[(0,l.jsxs)(w.fK,{className:"p-4 border-b bg-gray-100",children:[(0,l.jsx)(w.$N,{children:"Rename this channel"}),(0,l.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:"Channel names must be lowercase and without spaces"})]}),(0,l.jsxs)("form",{className:"p-4 space-y-6",onSubmit:e=>{e.preventDefault(),k({id:a,name:o},{onSuccess:()=>{u.Am.success("Channel name updated successfully"),S(!1)},onError:()=>{u.Am.error("Failed to update channel name")},onSettled:()=>{A()}})},children:[(0,l.jsxs)("div",{className:"space-y-2",children:[(0,l.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Channel name"}),(0,l.jsxs)("div",{className:"relative",children:[(0,l.jsx)("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 select-none",children:"#"}),(0,l.jsx)(y.I,{value:c,onChange:e=>{let s=e.target.value.replace(/\s+/g,"-").toLowerCase();d(s),C(s)},disabled:I,required:!0,autoFocus:!0,minLength:3,maxLength:80,placeholder:"e.g. plan-budget",className:"pl-7 pr-3 h-10 border-gray-300"})]}),(0,l.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:[c.length,"/80 characters"]})]}),(0,l.jsxs)(w.cN,{className:"gap-x-2",children:[(0,l.jsx)(w.GG,{asChild:!0,children:(0,l.jsx)(N.z,{variant:"outline",disabled:I,onClick:A,children:"Cancel"})}),(0,l.jsx)(N.z,{type:"submit",disabled:!c.trim()||I||c===s,children:"Save changes"})]})]})]})]}),(null==i?void 0:i.role)==="admin"&&(0,l.jsxs)("button",{onClick:L,disabled:z,className:"flex items-center gap-x-2 px-5 py-4 bg-gray-100 rounded-xl border border-gray-200 cursor-pointer hover:bg-rose-50 text-rose-600 hover:text-rose-700 transition-all duration-150 ease-in-out hover:shadow-sm",children:[(0,l.jsx)(h.Z,{className:"size-4"}),(0,l.jsx)("p",{className:"text-sm font-semibold",children:"Delete channel"})]})]})]})]})]})},M=t(166),S=t(6046),E=t(9975);let _=(0,M.default)(()=>Promise.all([t.e(466),t.e(665),t.e(546),t.e(145),t.e(637)]).then(t.bind(t,2229)),{loadableGenerated:{webpack:()=>[2229]},ssr:!1}),k=e=>{let{placeholder:s}=e,[t,a]=(0,m.useState)(0),[r,i]=(0,m.useState)(!1),o=(0,m.useRef)(null),d=(0,b.m)(),c=(0,n.b)(),{mutate:h}=(0,S.g)(),{mutate:x}=(0,E.u)(),f=async e=>{var s,t;let{body:l,image:r}=e;try{i(!0),null==o||null===(s=o.current)||void 0===s||s.enable(!1);let e={channelId:c,workspaceId:d,body:l,image:void 0};if(r){let s=await x({},{throwError:!0});if(!s)throw Error("Image URL not found");let t=await fetch(s,{method:"POST",headers:{"Content-Type":r.type},body:r});if(!t.ok)throw Error("Failed to upload image");let{storageId:l}=await t.json();e.image=l}await h(e,{throwError:!0}),a(e=>e+1)}catch(e){console.log(e),u.Am.error("Message failed to send")}finally{i(!1),null==o||null===(t=o.current)||void 0===t||t.enable(!0)}};return(0,l.jsx)("div",{className:"px-5 w-full",children:(0,l.jsx)(_,{placeholder:s,onSubmit:f,disabled:r,innerRef:o},t)})};var I=t(8673),T=()=>{let e=(0,n.b)(),{results:s,status:t,loadMore:i}=(0,c.K)({channelId:e}),{data:o,isLoading:u}=d({id:e});return(console.log({results:s}),u||"LoadingFirstPage"===t)?(0,l.jsx)("div",{className:"h-full flex-1 flex items-center justify-center",children:(0,l.jsx)(a.Z,{className:"animate-spin size-5 text-muted-foreground"})}):o?(0,l.jsxs)("div",{className:"flex flex-col h-full",children:[(0,l.jsx)(C,{title:o.name}),(0,l.jsx)(I.r,{channelName:o.name,channelCreationTime:o._creationTime,data:s,loadMore:i,isLoadingMore:"LoadingMore"===t,canLoadMore:"CanLoadMore"===t}),(0,l.jsx)(k,{placeholder:"Message # ".concat(o.name)})]}):(0,l.jsxs)("div",{className:"h-full flex-1 flex flex-col gap-y-2 items-center justify-center",children:[(0,l.jsx)(r.Z,{className:"size-5 text-muted-foreground"}),(0,l.jsx)("span",{className:"text-sm text-muted-foreground",children:"Channel not found."})]})}},8673:function(e,s,t){"use strict";t.d(s,{r:function(){return g}});var l=t(7437),a=t(2265),r=t(6540),n=t(6614),i=t(7300),o=t(5432),d=t(769),c=t(3106),u=t(9279),m=t(5360);let h=e=>{let{name:s,creationTime:t}=e;return(0,l.jsxs)("div",{className:"mt-[88px] mx-5 mb-4",children:[(0,l.jsxs)("p",{className:"text-2xl font-bold flex items-center mb-2",children:["# ",s]}),(0,l.jsxs)("p",{className:"font-normal text-slate-800 mb-4",children:["Welcome to the beginning of the ",(0,l.jsxs)("strong",{children:["# ",s]})," channel! Created on ",(0,o.WU)(t,"MMMM do, yyyy"),"."]}),(0,l.jsx)("p",{className:"text-sm text-slate-600",children:"This is where your team's conversations will live. Share messages, files, and collaborate together in this space."})]})};var x=t(6246);let f=e=>{let{name:s="Member",image:t}=e,a=s.charAt(0).toUpperCase();return(0,l.jsxs)("div",{className:"mt-[88px] mx-5 mb-4",children:[(0,l.jsxs)("div",{className:"flex items-center gap-x-1 mb-2",children:[(0,l.jsxs)(x.qE,{className:"size-14 mr-2",children:[(0,l.jsx)(x.F$,{src:t}),(0,l.jsx)(x.Q5,{children:a})]}),(0,l.jsx)("p",{className:"text-2xl font-bold",children:s})]}),(0,l.jsx)("p",{className:"font-normal text-slate-800 mb-4",children:s}),(0,l.jsxs)("p",{className:"text-sm text-slate-600",children:["This conversation is visible only for yourself and"," ",(0,l.jsx)("strong",{children:s})]})]})},b=e=>{let s=new Date(e);return(0,n.z)(s)?"Today":(0,i.g)(s)?"Yesterday":(0,o.WU)(s,"EEEE, MMMM d")},g=e=>{let{memberName:s,memberImage:t,channelName:n,channelCreationTime:i,data:x,variant:g="channel",loadMore:p,isLoadingMore:v,canLoadMore:j}=e,[y,N]=(0,a.useState)(null),w=(0,c.m)(),{data:C}=(0,u.i)({workspaceId:w}),M=null==x?void 0:x.reduce((e,s)=>{let t=new Date(s._creationTime),l=(0,o.WU)(t,"MM-dd-yyyy");return e[l]||(e[l]=[]),e[l].unshift(s),e},{});return(0,l.jsxs)("div",{className:"flex-1 flex flex-col-reverse pb-4 overflow-y-auto messages-scrollbar",children:[Object.entries(M||{}).map(e=>{let[s,t]=e;return(0,l.jsxs)("div",{children:[(0,l.jsxs)("div",{className:"text-center my-2 relative",children:[(0,l.jsx)("hr",{className:"absolute top-1/2 left-0 right-0 border-t border-gray-300"}),(0,l.jsx)("span",{className:"relative inline-block bg-white px-4 py-1 rounded-full text-xs border border-gray-300 shadow-sm",children:b(s)})]}),t.map((e,s)=>{var a,r;let n=t[s-1],i=n&&(null===(a=n.user)||void 0===a?void 0:a._id)===(null===(r=e.user)||void 0===r?void 0:r._id)&&5>(0,d.X)(new Date(e._creationTime),new Date(n._creationTime));return console.log(e),(0,l.jsx)(m.v,{id:e._id,memberId:e.memberId,authorImage:e.user.image,isAuthor:e.memberId===(null==C?void 0:C._id),authorName:e.user.name,reactions:e.reactions,body:e.body,image:e.image,updatedAt:e.updatedAt,createdAt:e._creationTime,isEditing:y===e._id,setEditingId:N,isCompact:i,hideThreadButton:"thread"===g,threadCount:e.threadCount,threadImage:e.threadImage,threadName:e.threadName,threadTimestamp:e.threadTimestamp},e._id)})]},s)}),(0,l.jsx)("div",{className:"h-1",ref:e=>{if(e){let s=new IntersectionObserver(e=>{let[s]=e;s.isIntersecting&&j&&p()},{threshold:1});return s.observe(e),()=>s.disconnect()}}}),v&&(0,l.jsxs)("div",{className:"text-center my-2 relative",children:[(0,l.jsx)("hr",{className:"absolute top-1/2 left-0 right-0 border-t border-gray-300"}),(0,l.jsx)("span",{className:"relative inline-block bg-white px-4 py-1 rounded-full text-xs border border-gray-300 shadow-sm",children:(0,l.jsx)(r.Z,{className:"size-4 animate-spin"})})]}),"channel"===g&&n&&i&&(0,l.jsx)(h,{name:n,creationTime:i}),"conversation"===g&&(0,l.jsx)(f,{name:s,image:t})]})}},279:function(e,s,t){"use strict";t.d(s,{I:function(){return n}});var l=t(7437),a=t(2265),r=t(3448);let n=a.forwardRef((e,s)=>{let{className:t,type:a,...n}=e;return(0,l.jsx)("input",{type:a,className:(0,r.cn)("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:s,...n})});n.displayName="Input"},8291:function(e,s,t){"use strict";t.d(s,{b:function(){return a}});var l=t(9376);let a=()=>(0,l.useParams)().channelId}},function(e){e.O(0,[699,51,560,432,317,279,579,644,147,553,811,971,117,744],function(){return e(e.s=6822)}),_N_E=e.O()}]);
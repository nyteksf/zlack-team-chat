(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[217],{1435:function(e,t,r){Promise.resolve().then(r.bind(r,9914))},9914:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return _}});var s=r(7437),a=r(4438),l=r(2265),n=r(6540),i=r(6865),o=r(1615),d=r(3106),c=r(2618),m=r(4749),u=r(6136),h=r(9089),x=r(2381),f=r(6246),v=e=>{let{memberName:t="Member",memberImage:r,onClick:a}=e,l=t.charAt(0).toUpperCase();return(0,s.jsx)("div",{className:"bg-white border-b h-[49px] flex items-center px-4 overflow-hidden",children:(0,s.jsxs)(x.z,{variant:"ghost",className:"text-lg font-semibold px-2 overflow-hidden w-auto",size:"sm",onClick:a,children:[(0,s.jsxs)(f.qE,{className:"size-6 mr-2",children:[(0,s.jsx)(f.F$,{src:r}),(0,s.jsx)(f.Q5,{children:l})]}),(0,s.jsx)("span",{className:"truncate",children:t}),(0,s.jsx)(h.RiI,{className:"size-2.5 ml-2"})]})})},b=r(166),g=r(6046),j=r(9975);let p=(0,b.default)(()=>Promise.all([r.e(466),r.e(665),r.e(546),r.e(145),r.e(637)]).then(r.bind(r,2229)),{loadableGenerated:{webpack:()=>[2229]},ssr:!1}),N=e=>{let{placeholder:t,conversationId:r}=e,[n,i]=(0,l.useState)(0),[o,c]=(0,l.useState)(!1),m=(0,l.useRef)(null),u=(0,d.m)(),{mutate:h}=(0,g.g)(),{mutate:x}=(0,j.u)(),f=async e=>{var t,s;let{body:l,image:n}=e;try{c(!0),null==m||null===(t=m.current)||void 0===t||t.enable(!1);let e={conversationId:r,workspaceId:u,body:l,image:void 0};if(n){let t=await x({},{throwError:!0});if(!t)throw Error("Image URL not found");let r=await fetch(t,{method:"POST",headers:{"Content-Type":n.type},body:n});if(!r.ok)throw Error("Failed to upload image");let{storageId:s}=await r.json();e.image=s}await h(e,{throwError:!0}),i(e=>e+1)}catch(e){a.Am.error("Message failed to send"),console.log(e)}finally{c(!1),null==m||null===(s=m.current)||void 0===s||s.enable(!0)}};return(0,s.jsx)("div",{className:"px-5 w-full",children:(0,s.jsx)(p,{placeholder:t,onSubmit:f,disabled:o,innerRef:m},n)})};var y=r(8673);let w=e=>{let{id:t}=e,r=(0,o.H)(),{onOpenProfile:a}=(0,u.u)(),{data:l,isLoading:i}=(0,c.R)({id:r}),{results:d,status:h,loadMore:x}=(0,m.K)({conversationId:t});return i||"LoadingFirstPage"===h?(0,s.jsx)("div",{className:"h-full flex items-center justify-center",children:(0,s.jsx)(n.Z,{className:"size-6 animate-spin text-muted-foreground"})}):(0,s.jsxs)("div",{className:"flex flex-col h-full",children:[(0,s.jsx)(v,{memberName:null==l?void 0:l.user.name,memberImage:null==l?void 0:l.user.image,onClick:()=>a(r)}),(0,s.jsx)(y.r,{data:d,variant:"conversation",memberImage:null==l?void 0:l.user.image,memberName:null==l?void 0:l.user.name,loadMore:x,isLoadingMore:"LoadingMore"===h,canLoadMore:"CanLoadMore"===h}),(0,s.jsx)(N,{placeholder:"Message ".concat(null==l?void 0:l.user.name),conversationId:t})]})};var M=r(7266),E=r(1620);let I=()=>{let[e,t]=(0,l.useState)(null),[r,s]=(0,l.useState)(null),[a,n]=(0,l.useState)(null),i=(0,l.useMemo)(()=>"pending"===a,[a]),o=(0,l.useMemo)(()=>"success"===a,[a]),d=(0,l.useMemo)(()=>"error"===a,[a]),c=(0,l.useMemo)(()=>"settled"===a,[a]),m=(0,M.Db)(E.h.conversations.createOrGet);return{mutate:(0,l.useCallback)(async(e,r)=>{var a,l,i;try{t(null),s(null),n("pending");let l=await m(e);return null==r||null===(a=r.onSuccess)||void 0===a||a.call(r,l),l}catch(e){if(n("error"),null==r||null===(l=r.onError)||void 0===l||l.call(r,e),null==r?void 0:r.throwError)throw e}finally{n("settled"),null==r||null===(i=r.onSettled)||void 0===i||i.call(r)}},[m]),data:e,error:r,isPending:i,isSuccess:o,isError:d,isSettled:c}};var _=()=>{let e=(0,o.H)(),t=(0,d.m)(),[r,c]=(0,l.useState)(null),{mutate:m,isPending:u}=I();return((0,l.useEffect)(()=>{m({workspaceId:t,memberId:e},{onSuccess(e){c(e)},onError(e){a.Am.error("Failed to get or create conversation"),console.log(e)}})},[e,t,m]),u)?(0,s.jsx)("div",{className:"h-full flex items-center justify-center",children:(0,s.jsx)(n.Z,{className:"size-6 animate-spin text-muted-foreground"})}):r?(0,s.jsx)(w,{id:r}):(0,s.jsxs)("div",{className:"h-full flex flex-col gap-y-2 items-center justify-center",children:[(0,s.jsx)(i.Z,{className:"size-6 text-muted-foreground"}),(0,s.jsx)("span",{className:"text-sm text-muted-foreground",children:"Conversation not found"})]})}},8673:function(e,t,r){"use strict";r.d(t,{r:function(){return b}});var s=r(7437),a=r(2265),l=r(6540),n=r(6614),i=r(7300),o=r(5432),d=r(769),c=r(3106),m=r(9279),u=r(5360);let h=e=>{let{name:t,creationTime:r}=e;return(0,s.jsxs)("div",{className:"mt-[88px] mx-5 mb-4",children:[(0,s.jsxs)("p",{className:"text-2xl font-bold flex items-center mb-2",children:["# ",t]}),(0,s.jsxs)("p",{className:"font-normal text-slate-800 mb-4",children:["Welcome to the beginning of the ",(0,s.jsxs)("strong",{children:["# ",t]})," channel! Created on ",(0,o.WU)(r,"MMMM do, yyyy"),"."]}),(0,s.jsx)("p",{className:"text-sm text-slate-600",children:"This is where your team's conversations will live. Share messages, files, and collaborate together in this space."})]})};var x=r(6246);let f=e=>{let{name:t="Member",image:r}=e,a=t.charAt(0).toUpperCase();return(0,s.jsxs)("div",{className:"mt-[88px] mx-5 mb-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-x-1 mb-2",children:[(0,s.jsxs)(x.qE,{className:"size-14 mr-2",children:[(0,s.jsx)(x.F$,{src:r}),(0,s.jsx)(x.Q5,{children:a})]}),(0,s.jsx)("p",{className:"text-2xl font-bold",children:t})]}),(0,s.jsx)("p",{className:"font-normal text-slate-800 mb-4",children:t}),(0,s.jsxs)("p",{className:"text-sm text-slate-600",children:["This conversation is visible only for yourself and"," ",(0,s.jsx)("strong",{children:t})]})]})},v=e=>{let t=new Date(e);return(0,n.z)(t)?"Today":(0,i.g)(t)?"Yesterday":(0,o.WU)(t,"EEEE, MMMM d")},b=e=>{let{memberName:t,memberImage:r,channelName:n,channelCreationTime:i,data:x,variant:b="channel",loadMore:g,isLoadingMore:j,canLoadMore:p}=e,[N,y]=(0,a.useState)(null),w=(0,c.m)(),{data:M}=(0,m.i)({workspaceId:w}),E=null==x?void 0:x.reduce((e,t)=>{let r=new Date(t._creationTime),s=(0,o.WU)(r,"MM-dd-yyyy");return e[s]||(e[s]=[]),e[s].unshift(t),e},{});return(0,s.jsxs)("div",{className:"flex-1 flex flex-col-reverse pb-4 overflow-y-auto messages-scrollbar",children:[Object.entries(E||{}).map(e=>{let[t,r]=e;return(0,s.jsxs)("div",{children:[(0,s.jsxs)("div",{className:"text-center my-2 relative",children:[(0,s.jsx)("hr",{className:"absolute top-1/2 left-0 right-0 border-t border-gray-300"}),(0,s.jsx)("span",{className:"relative inline-block bg-white px-4 py-1 rounded-full text-xs border border-gray-300 shadow-sm",children:v(t)})]}),r.map((e,t)=>{var a,l;let n=r[t-1],i=n&&(null===(a=n.user)||void 0===a?void 0:a._id)===(null===(l=e.user)||void 0===l?void 0:l._id)&&5>(0,d.X)(new Date(e._creationTime),new Date(n._creationTime));return console.log(e),(0,s.jsx)(u.v,{id:e._id,memberId:e.memberId,authorImage:e.user.image,isAuthor:e.memberId===(null==M?void 0:M._id),authorName:e.user.name,reactions:e.reactions,body:e.body,image:e.image,updatedAt:e.updatedAt,createdAt:e._creationTime,isEditing:N===e._id,setEditingId:y,isCompact:i,hideThreadButton:"thread"===b,threadCount:e.threadCount,threadImage:e.threadImage,threadName:e.threadName,threadTimestamp:e.threadTimestamp},e._id)})]},t)}),(0,s.jsx)("div",{className:"h-1",ref:e=>{if(e){let t=new IntersectionObserver(e=>{let[t]=e;t.isIntersecting&&p&&g()},{threshold:1});return t.observe(e),()=>t.disconnect()}}}),j&&(0,s.jsxs)("div",{className:"text-center my-2 relative",children:[(0,s.jsx)("hr",{className:"absolute top-1/2 left-0 right-0 border-t border-gray-300"}),(0,s.jsx)("span",{className:"relative inline-block bg-white px-4 py-1 rounded-full text-xs border border-gray-300 shadow-sm",children:(0,s.jsx)(l.Z,{className:"size-4 animate-spin"})})]}),"channel"===b&&n&&i&&(0,s.jsx)(h,{name:n,creationTime:i}),"conversation"===b&&(0,s.jsx)(f,{name:t,image:r})]})}},2618:function(e,t,r){"use strict";r.d(t,{R:function(){return l}});var s=r(7266),a=r(1620);let l=e=>{let{id:t}=e,r=(0,s.aM)(a.h.members.getById,{id:t});return{data:r,isLoading:void 0===r}}},1615:function(e,t,r){"use strict";r.d(t,{H:function(){return a}});var s=r(9376);let a=()=>(0,s.useParams)().memberId}},function(e){e.O(0,[699,51,560,432,317,279,579,644,147,553,811,971,117,744],function(){return e(e.s=1435)}),_N_E=e.O()}]);